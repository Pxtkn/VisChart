<!DOCTYPE html>
<html lang="zh-CN" style="height: 100%">
<head>
  <meta charset="utf-8">
</head>
<body style="height: 100%; margin: 0">
  <div id="container" style="height: 100%"></div>

  <script type="text/javascript" src="https://fastly.jsdelivr.net/npm/jquery"></script>
  <script type="text/javascript" src="https://fastly.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
  <!-- Uncomment this line if you want to dataTool extension
  <script type="text/javascript" src="https://fastly.jsdelivr.net/npm/echarts@5.4.3/dist/extension/dataTool.min.js"></script>
  -->
  <!-- Uncomment this line if you want to use gl extension
  <script type="text/javascript" src="https://fastly.jsdelivr.net/npm/echarts-gl@2/dist/echarts-gl.min.js"></script>
  -->
  <!-- Uncomment this line if you want to echarts-stat extension
  <script type="text/javascript" src="https://fastly.jsdelivr.net/npm/echarts-stat@latest/dist/ecStat.min.js"></script>
  -->
  <!-- Uncomment this line if you want to use map
  <script type="text/javascript" src="https://fastly.jsdelivr.net/npm/echarts@4.9.0/map/js/china.js"></script>
  <script type="text/javascript" src="https://fastly.jsdelivr.net/npm/echarts@4.9.0/map/js/world.js"></script> 
  -->
  <!-- Uncomment these two lines if you want to use bmap extension
  <script type="text/javascript" src="https://api.map.baidu.com/api?v=3.0&ak=YOUR_API_KEY"></script>
  <script type="text/javascript" src="https://fastly.jsdelivr.net/npm/echarts@5.4.3/dist/extension/bmap.min.js"></script>
  -->

  <script type="text/javascript">
    var dom = document.getElementById('container');
    var myChart = echarts.init(dom, null, {
      renderer: 'canvas',
      useDirtyRect: false
    });
    var app = {};
    var option;

    myChart.showLoading();
$.get('roughworld.geo.json', function (usaJson) {
  myChart.hideLoading();
  echarts.registerMap('TheWorld', usaJson, );
  option = {
    legend: [
      {
        data: ['crop 1', 'crop 2', 'crop 3'],
        orient: 'vertical',
        top: '90%',
        left: '5%',
        selected: {
          'population': false,
          'crop 1': true,
          'crop 2': true,
          'crop 3': true,
        }
      }
    ],
<!--参数传入-->
    dataset: [
      {
        source: [
          ['Category', 'China', 'India', 'Canada', 'Brazil'],
          ['population', 1400000000, 1600000000, 90000000, 130000000],
          ['crop 1', 10, 20, 55, 5],
          ['crop 2', 30, 15, 20, 35],
          ['crop 3', 45, 50, 5, 10]
        ]
      },
      {
        transform: {
          type: 'filter',
          config: { dimension: 'Category', value:'population'},
        }
      },
      {
        transform: {
          type: 'filter',
          config: { dimention: 'Category', '!': ['population']},
        }
      }
    ],
    title: {
      text: '砸瓦鲁多',
      left: 'right'
    },
    tooltip: {
      trigger: 'item',
      showDelay: 0,
      transitionDuration: 0.2
    },
    visualMap: [
      { 
        type: 'continuous',
        seriesIndex: 0,
        left: 'right',
        min: 500000,
        max: 1800000000,
        inRange: {
          color: [
            '#313695',
            '#4575b4',
            '#74add1',
            '#fee090',
            '#fdae61',
            '#f46d43',
            '#d73027',
            '#a50026'
          ],
          symbolSize: [30, 100]
        },
        text: ['Population\nHigh', 'Low'],
        calculable: true,
        center: ['50%', '30%'],
      },
      {
        // type: 'continuous',
        seriesIndex: 1,
        left: 'left',
        top: 'top',
        min: 0,
        max: 50,
        // inRange: {
        color: [
          '#F8F8FF',
          '#778899',
          '#0000CD',
          '#006400',
          '#CD5C5C',
          '#FF00FF',
          '#FFC125',
          '#FFC125'
        ],
        symbolSize: [30, 100],
        // },
        text: ['Crops\nHigh', 'Low'],
        calculable: true,
        center: ['50%', '30%'],
        show: false,
      }
    ],
    toolbox: {
      show: true,
      orient: 'horizontal',
      left: 'right',
      top: '3%',
      feature: {
        dataView: { readOnly: false },
        restore: {},
        saveAsImage: {}
      },
    },
    series: [
      {
        datasetIndex: 1,
        name: 'of the world',
        type: 'map',
        roam: true,
        map: 'TheWorld',
        seriesLayoutBy: 'row',
        emphasis: {
          focus: 'self',
          label: {
            show: true
          },
        },
      },
      {
        datasetInex: 2, 
        name: 'crops',
        type: 'pie',
        roseType: 'radius',
        id: 'pie',
        radius: ['8%', '25%'],
        center: ['47%', '85%'],
        itemStyle: {
          borderRadius: 8
        },
        emphasis: {
          focus: 'series',
          itemStyle: {
            color: 'white'
          },
        },
        encode: {
          itemName: 'Category',
          value: 'China',
          tooltip: 'China'
        },
        tooltip: {
          trigger: 'item',
          formatter: '{b}:  {d}%'
        },
        visualMap: false,
      }
    ]
  };

  myChart.on('click', function (event) {
    const clickon = event.data[0];
    // console.log('dataset');
    // console.log(event);
    if (clickon) {
      myChart.setOption({
        series: {
          id: 'pie',
          label: {
            formatter: '{b}: {@[' + clickon + ']} ({d}%)'
          },
          encode: {
            value: clickon,
            tooltip: clickon,
            visualMap: clickon
          },
        }
      });
    }
  });
  myChart.setOption(option);
});

    if (option && typeof option === 'object') {
      myChart.setOption(option);
    }

    window.addEventListener('resize', myChart.resize);
  </script>
</body>
</html>